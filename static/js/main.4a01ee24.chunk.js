(this["webpackJsonpjmap-webmail"]=this["webpackJsonpjmap-webmail"]||[]).push([[0],{42:function(e,t,n){},47:function(e,t,n){},54:function(e,t,n){},55:function(e,t,n){},56:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(25),c=n.n(i),s=(n(41),n(42),n(5)),o=(n(43),n(47),n(7)),l=n.n(o),u=n(14),d=n(8),b=n(59),m=n(13),j=n(15),h=n(35),p=n(31),f=n.n(p),x=n(1),O=["html"],v=function(e){var t=e.html,n=Object(h.a)(e,O),r=Object(a.useRef)(null),i=Object(a.useState)(null),c=Object(j.a)(i,2),s=c[0],o=c[1];return Object(a.useEffect)((function(){r.current&&!s&&o(r.current.attachShadow({mode:"open"}))}),[r,s]),Object(a.useEffect)((function(){if(s){var e=f.a.sanitize(t,{RETURN_DOM:!0});e.querySelectorAll("a").forEach((function(e){e.target="_blank",e.rel="noopener noreferrer"})),s.innerHTML="",s.appendChild(e)}}),[s,t]),Object(x.jsx)("div",Object(m.a)(Object(m.a)({},n),{},{ref:r}))},g=n(32),y=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="https://".concat(t,"/.well-known/jmap"),e.next=3,fetch(n);case 3:return a=e.sent,e.abrupt("return",a.url);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(u.a)(l.a.mark((function e(t,n,a){var r,i,c,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:new Headers(Object(m.a)(Object(m.a)({},a),{},{"Content-Type":"application/json"})),method:"POST",body:JSON.stringify({using:["urn:ietf:params:jmap:core","urn:ietf:params:jmap:mail"],methodCalls:[["Mailbox/get",{accountId:n,ids:null},"0"]]})});case 2:return r=e.sent,e.next=5,r.json();case 5:if((i=e.sent).methodResponses){e.next=8;break}return e.abrupt("return",{success:!1,message:"not a valid JMAP response"});case 8:if((c=i.methodResponses)&&Array.isArray(c)&&1===c.length){e.next=11;break}return e.abrupt("return",{success:!1,message:"no valid response"});case 11:if("Mailbox/get"===(s=c[0])[0]){e.next=14;break}return e.abrupt("return",{success:!1,message:"not the expected method"});case 14:if(s[1]&&s[1].list&&Array.isArray(s[1].list)){e.next=16;break}return e.abrupt("return",{success:!1,message:"could not fetch mailboxes"});case 16:return o=s[1].list,e.abrupt("return",{success:!0,data:o});case 18:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),N=function(){var e=Object(u.a)(l.a.mark((function e(t,n,a){var r,i,c,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:new Headers(Object(m.a)(Object(m.a)({},a),{},{"Content-Type":"application/json"})),method:"POST",body:JSON.stringify({using:["urn:ietf:params:jmap:core","urn:ietf:params:jmap:mail"],methodCalls:[["Email/query",{accountId:n,position:0,limit:100,calculateTotal:!0},"0"],["Email/get",{accountId:n,"#ids":{resultOf:"0",name:"Email/query",path:"/ids"},properties:["threadId","mailboxIds","keywords","hasAttachment","from","subject","receivedAt","size","preview"]},"1"]]})});case 2:return r=e.sent,e.next=5,r.json();case 5:if((i=e.sent).methodResponses){e.next=8;break}return e.abrupt("return",{success:!1,message:"not a valid JMAP response"});case 8:if((c=i.methodResponses)&&Array.isArray(c)&&2===c.length){e.next=11;break}return e.abrupt("return",{success:!1,message:"no valid response"});case 11:if("Email/get"===(s=c[1])[0]){e.next=14;break}return e.abrupt("return",{success:!1,message:"not the expected method"});case 14:if(s[1]&&s[1].list&&Array.isArray(s[1].list)){e.next=16;break}return e.abrupt("return",{success:!1,message:"could not fetch emails"});case 16:return o=s[1].list,e.abrupt("return",{success:!0,data:o});case 18:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),k=function(){var e=Object(u.a)(l.a.mark((function e(t,n,a,r){var i,c,s,o,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:new Headers(Object(m.a)(Object(m.a)({},r),{},{"Content-Type":"application/json"})),method:"POST",body:JSON.stringify({using:["urn:ietf:params:jmap:core","urn:ietf:params:jmap:mail"],methodCalls:[["Email/get",{accountId:n,ids:[a],properties:["threadId","mailboxIds","keywords","hasAttachment","from","subject","receivedAt","size","preview","htmlBody"]},"0"]]})});case 2:return i=e.sent,e.next=5,i.json();case 5:if((c=e.sent).methodResponses){e.next=8;break}return e.abrupt("return",{success:!1,message:"not a valid JMAP response"});case 8:if((s=c.methodResponses)&&Array.isArray(s)&&1===s.length){e.next=11;break}return e.abrupt("return",{success:!1,message:"no valid response"});case 11:if("Email/get"===(o=s[0])[0]){e.next=14;break}return e.abrupt("return",{success:!1,message:"not the expected method"});case 14:if(o[1]&&o[1].list&&Array.isArray(o[1].list)&&1===o[1].list.length){e.next=16;break}return e.abrupt("return",{success:!1,message:"could not fetch email"});case 16:return u=o[1].list[0],e.abrupt("return",{success:!0,data:u});case 18:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),I=function(){var e=Object(u.a)(l.a.mark((function e(t,n){var a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:new Headers(Object(m.a)(Object(m.a)({},n),{},{"Content-Type":"application/json"})),method:"GET"});case 2:return a=e.sent,e.next=5,a.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),A=function(e,t){return g.a.encode("".concat(e,":").concat(t))},E=n(18),S=Object(E.b)({name:"login",initialState:{authenticated:!1,authorizationHeader:"",identifier:"",downloadUrl:"",endpoint:""},reducers:{login:function(e,t){e.authenticated=!0,e.authorizationHeader=t.payload.authorizationHeader,e.identifier=t.payload.identifier,e.downloadUrl=t.payload.downloadUrl,e.endpoint=t.payload.endpoint},logout:function(e){e.authenticated=!1,e.authorizationHeader="",e.identifier="",e.downloadUrl="",e.endpoint=""}}}),C=S.actions,U=C.login,z=(C.logout,function(e){return e.login.authenticated}),M=function(e){return{authorizationHeader:e.login.authorizationHeader,identifier:e.login.identifier,downloadUrl:e.login.downloadUrl,endpoint:e.login.endpoint}},H=S.reducer,P=function(e,t,n,a,r,i){return new URL(r.replace(/{accountId}/g,encodeURI(e)).replace(/{blobId}/g,encodeURI(t)).replace(/{name}/g,encodeURI(n)).replace(/{type}/g,encodeURI(a)),i).href},R=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a,r,i,c,s,o,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.endpoint,a=t.identifier,r=t.mailId,i=t.authorizationHeader,c=t.downloadUrl,e.next=3,k(n,a,r,{Authorization:i});case 3:if((s=e.sent).success){e.next=6;break}return e.abrupt("return");case 6:if((o=s.data).htmlBody&&!(o.htmlBody.length<1)){e.next=9;break}return e.abrupt("return");case 9:if((u=o.htmlBody[0]).blobId){e.next=12;break}return e.abrupt("return");case 12:return d=P(a,u.blobId,"content","".concat(u.type,";charset=").concat(u.charset),c,n),e.abrupt("return",fetch(d,{headers:new Headers({"Content-Type":"application/json",Authorization:i})}).then((function(e){return e.text()})).then((function(e){return{content:e,type:u.type}})));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var B=function(e){var t=e.mailId,n=Object(d.d)(M),a=n.authorizationHeader,r=n.endpoint,i=n.identifier,c=n.downloadUrl,s=Object(b.a)("mail/".concat(t),(function(){return R({endpoint:r,identifier:i,mailId:t,authorizationHeader:a,downloadUrl:c})})),o=s.isLoading,l=s.error,u=s.data;return o?Object(x.jsx)("p",{children:"Loading\u2026"}):l||!u?Object(x.jsx)("p",{children:"An error occured while trying to load the email content\u2026 Please try refreshing the page!"}):Object(x.jsx)("div",{className:"mail-layout-center has-background-white is-flex-direction-column",children:Object(x.jsx)("div",{className:"has-text-left",children:"text/plain"===u.type&&Object(x.jsx)("pre",{className:"p-4 has-background-white",children:Object(x.jsx)(v,{html:u.content})})||Object(x.jsx)(v,{html:u.content})})})};var T=function(){return Object(x.jsx)("div",{className:"mail-layout-center",children:Object(x.jsx)("div",{className:"has-text-weight-bold",children:"Nothing selected"})})},J=n(17),F=(n(27),function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,a="",r=0;r<e;r++)a+=t.charAt(Math.floor(Math.random()*n));return a}),L=function(e,t,n,a){return{name:e||"(unknown)",role:t||"",id:n||F(36),unreadEmails:a||0}},D={mailboxes:[L("INBOX","inbox","00000000-0000-0000-0000-000000000001",1)],list:[]},q=Object(E.b)({name:"mail",initialState:D,reducers:{setMailboxes:function(e,t){e.mailboxes=t.payload},setList:function(e,t){e.list=t.payload}}}),W=q.actions,Y=W.setMailboxes,G=W.setList,X=function(e){return e.mail.mailboxes},$=function(e){return e.mail.list},_=q.reducer,K="/mail/",Q=function(){var e=Object(s.g)("".concat(K,":mailboxId")),t=Object(s.g)("".concat(K,":mailboxId/:mailId")),n=(null===e||void 0===e?void 0:e.params.mailboxId)||"";return{mailboxId:n,mailId:n&&(null===t||void 0===t?void 0:t.params.mailId)||""}},V=function(e){switch(e.role){case"inbox":return"Inbox";case"drafts":return"Drafts";case"sent":return"Sent Messages";case"junk":return"Junk";case"trash":return"Deleted Messages";case"archive":return"Archive"}return e.name},Z=function(e){switch(e.role){case"inbox":return"fas fa-inbox";case"drafts":return"fas fa-pencil-alt";case"sent":return"fas fa-paper-plane";case"junk":return"far fa-times-circle";case"trash":return"fas fa-trash-alt";case"archive":return"fas fa-archive"}return"Notes"===e.name?"far fa-sticky-note":"far fa-folder"},ee=function(e){return!e.from||e.from.length<1?"(unknown)":e.from.map((function(e){return(null===(t=e)||void 0===t?void 0:t.name)?t.name:(null===t||void 0===t?void 0:t.email)?t.email:"(unknown)";var t})).join(", ")};var te=function(){return Object(x.jsx)("div",{className:"mail-layout-center",children:Object(x.jsxs)("div",{className:"has-text-weight-bold",children:["Mailbox is empty",Object(x.jsx)("nav",{className:"navbar has-no-background"})]})})};var ne=function(){var e=Q(),t=e.mailboxId,n=Object(d.d)(X),a=Object(d.d)($);if(!t){var r=n.filter((function(e){return"inbox"===e.role}));r.length>0&&(t=r[0].id)}var i=n.filter((function(e){return e.id===t})),c=i.length>0?i[0]:L(),s=a.filter((function(e){return!(!e.mailboxIds||!Object.prototype.hasOwnProperty.call(e.mailboxIds,c.id))&&e.mailboxIds[c.id]})),o=e.mailId||"",l=s.length>0?"has-background-white":"";return Object(x.jsxs)("div",{className:"is-flex is-flex-grow-1 is-flex-direction-column is-clipped",children:[Object(x.jsxs)("div",{className:"mail-layout-title",children:[Object(x.jsx)(J.b,{to:K,className:"button is-small is-white mr-3 only-mobile",children:Object(x.jsx)("span",{className:"icon is-small",children:Object(x.jsx)("i",{className:"fas fa-chevron-left"})})}),V(c)]}),Object(x.jsx)("div",{className:"is-flex is-flex-grow-1 is-flex-direction-column overflowable ".concat(l),children:0===s.length?Object(x.jsx)(te,{}):s.map((function(e){var n=function(e){var t;return!1===(null===e||void 0===e||null===(t=e.keywords)||void 0===t?void 0:t.$seen)}(e)||e.id===o?"app-item-selected":"app-item";return Object(x.jsx)(J.b,{to:"".concat(K).concat(t,"/").concat(e.id),children:Object(x.jsxs)("div",{className:n,children:[Object(x.jsx)("p",{children:ee(e)}),Object(x.jsx)("p",{children:e.subject}),Object(x.jsx)("p",{children:e.preview})]})},e.id)}))})]})};var ae=function(){return Object(x.jsx)("div",{className:"mail-layout-center",children:Object(x.jsx)("div",{className:"has-text-weight-bold",children:"You do not have any mailboxes"})})};var re=function(){var e=Object(d.d)(X),t=Q().mailboxId||"inbox";return"inbox"===t&&(t=e.length>0?e[0].id:""),0===e.length?Object(x.jsx)(ae,{}):Object(x.jsx)("div",{className:"is-flex-grow-1 overflowable",children:e.map((function(e){var n=e.id===t?"app-item-selected":"app-item";return Object(x.jsx)(J.b,{to:"/mail/".concat(e.id),children:Object(x.jsxs)("div",{className:"icon-text ".concat(n),children:[Object(x.jsx)("span",{className:"icon mr-3",children:Object(x.jsx)("i",{className:Z(e)})}),Object(x.jsx)("span",{children:V(e)}),e.unreadEmails>0&&Object(x.jsx)("span",{className:"tag is-normal is-rounded is-primary has-text-weight-bold ml-3",children:e.unreadEmails})]})},e.id)}))})};var ie,ce=function(){var e=Q(),t="",n="hide-mobile",a="hide-mobile";return e.mailboxId&&(e.mailId?(t="hide-mobile",n="hide-mobile",a=""):(t="hide-mobile",n="",a="hide-mobile")),Object(x.jsxs)("div",{className:"mail-layout",children:[Object(x.jsx)("div",{className:"mail-layout-mailboxes ".concat(t),children:Object(x.jsx)(re,{})}),Object(x.jsx)("div",{className:"mail-layout-focused mail-layout-list ".concat(n),children:Object(x.jsx)(ne,{})}),Object(x.jsx)("div",{className:"mail-layout-content ".concat(a),children:e.mailboxId&&e.mailId?Object(x.jsx)(B,{mailId:e.mailId}):Object(x.jsx)(T,{})})]})},se=function(e){return Object(x.jsx)(x.Fragment,{children:e.cond&&e.children})};n(54);!function(e){e[e.Identifier=0]="Identifier",e[e.Endpoint=1]="Endpoint",e[e.Credentials=2]="Credentials"}(ie||(ie={}));var oe=function(){var e=Object(d.c)(),t=Object(a.useState)(ie.Identifier),n=Object(j.a)(t,2),r=n[0],i=n[1],c=Object(a.useState)(""),s=Object(j.a)(c,2),o=s[0],b=s[1],m=Object(a.useState)(!1),h=Object(j.a)(m,2),p=h[0],f=h[1],O=Object(a.useState)(!1),v=Object(j.a)(O,2),g=v[0],k=v[1],E=Object(a.useState)(""),S=Object(j.a)(E,2),C=S[0],z=S[1],M=Object(a.useState)(""),H=Object(j.a)(M,2),P=H[0],R=H[1],B=Object(a.useState)(""),T=Object(j.a)(B,2),J=T[0],F=T[1],L=Object(a.useState)(!1),D=Object(j.a)(L,2),q=D[0],W=D[1],X=function(){var e=Object(u.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g){e.next=2;break}return e.abrupt("return");case 2:if(k(!0),C.includes("@")){e.next=8;break}return b("Your identifier is not an email. Please specify an endpoint manually."),i(ie.Endpoint),k(!1),e.abrupt("return");case 8:if(t=C.trim().split("@").pop()){e.next=14;break}return b("Unable to discover a domain name in your email identifier. Please specify an endpoint manually."),i(ie.Endpoint),k(!1),e.abrupt("return");case 14:return e.next=16,y(t);case 16:n=e.sent,F(n),i(ie.Credentials),k(!1);case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){var t=Object(u.a)(l.a.mark((function t(){var n,a,c,s,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!g){t.next=2;break}return t.abrupt("return");case 2:if(k(!0),r!==ie.Identifier){t.next=8;break}return k(!1),t.next=7,X();case 7:k(!0);case 8:if(r!==ie.Endpoint){t.next=15;break}if(""!==J){t.next=13;break}return b("Endpoint is empty."),k(!1),t.abrupt("return");case 13:W(!0),i(ie.Credentials);case 15:if(r!==ie.Credentials){t.next=46;break}return a="Basic ".concat(A(C,P)),t.prev=17,t.next=20,I(J,{Authorization:a});case 20:n=t.sent,t.next=28;break;case 23:return t.prev=23,t.t0=t.catch(17),b("Bad credentials. Please retry."),k(!1),t.abrupt("return");case 28:return c="",n.downloadUrl&&(c=n.downloadUrl),t.next=32,w(J,C,{Authorization:a});case 32:if((s=t.sent).success){t.next=37;break}return b(s.message),k(!1),t.abrupt("return");case 37:return t.next=39,N(J,C,{Authorization:a});case 39:if((o=t.sent).success){t.next=44;break}return b(o.message),k(!1),t.abrupt("return");case 44:return Object(d.b)((function(){e(U({identifier:C,authorizationHeader:a,downloadUrl:c,endpoint:J})),e(Y(s.data)),e(G(o.data))})),t.abrupt("return");case 46:k(!1);case 47:case"end":return t.stop()}}),t,null,[[17,23]])})));return function(){return t.apply(this,arguments)}}();return Object(x.jsx)("div",{className:"login-layout",children:Object(x.jsxs)("div",{children:[o&&Object(x.jsx)("article",{className:"message is-danger",children:Object(x.jsx)("div",{className:"message-body",children:o})}),Object(x.jsxs)("div",{className:"field",children:[Object(x.jsx)("label",{className:"label",htmlFor:"login-form-identifier",children:"Identifier"}),Object(x.jsx)("div",{className:"control",children:Object(x.jsx)("input",{autoFocus:!0,id:"login-form-identifier",className:"input",type:"email",placeholder:"john.doe@example.com",value:C,onChange:function(e){return z(e.target.value)}})})]}),Object(x.jsx)(se,{cond:p||r===ie.Endpoint||q,children:Object(x.jsxs)("div",{className:"field",children:[Object(x.jsx)("label",{className:"label",htmlFor:"login-form-endpoint",children:"Endpoint"}),Object(x.jsx)("div",{className:"control",children:Object(x.jsx)("input",{id:"login-form-endpoint",className:"input",type:"url",placeholder:"https://example.com",value:J,onChange:function(e){return F(e.target.value)}})}),Object(x.jsx)("p",{className:"help",children:Object(x.jsx)("span",{className:"has-text-primary has-pointer",onClick:X,children:"Discover endpoint"})})]})}),Object(x.jsx)(se,{cond:p,children:Object(x.jsxs)("div",{className:"field",children:[Object(x.jsx)("label",{className:"label",htmlFor:"login-form-method",children:"Authentication method"}),Object(x.jsx)("div",{className:"control",children:Object(x.jsx)("div",{className:"select is-fullwidth",children:Object(x.jsx)("select",{id:"login-form-method",disabled:!0,children:Object(x.jsx)("option",{value:"Basic",children:"Password"})})})}),Object(x.jsx)("p",{className:"help",children:Object(x.jsx)("span",{className:"has-text-primary has-pointer",children:"Discover the available authentication methods"})})]})}),Object(x.jsx)(se,{cond:p||r>=ie.Credentials,children:Object(x.jsxs)("div",{className:"field",children:[Object(x.jsx)("label",{className:"label",htmlFor:"login-form-password",children:"Password"}),Object(x.jsx)("div",{className:"control",children:Object(x.jsx)("input",{id:"login-form-password",className:"input",type:"password",placeholder:"********",value:P,onChange:function(e){return R(e.target.value)}})})]})}),Object(x.jsxs)("div",{className:"login-layout-bottom",children:[Object(x.jsx)("button",{className:"button is-primary",onClick:function(){return $()},disabled:""===C&&!p,children:p||r===ie.Credentials?"Sign In":"Next \xbb"}),Object(x.jsxs)("label",{className:"checkbox",children:[Object(x.jsx)("input",{type:"checkbox",checked:p,onChange:function(e){return f(e.target.checked)}}),Object(x.jsx)("span",{children:"More options"})]})]})]})})},le="/login/";n(55);var ue=function(){var e=Object(d.d)(z);return Object(x.jsxs)("div",{className:"app",children:[Object(x.jsx)("nav",{className:"navbar is-primary",children:Object(x.jsx)("div",{className:"navbar-brand",children:Object(x.jsx)("div",{className:"navbar-item",children:"JMAP Webmail"})})}),Object(x.jsx)("div",{className:"app-container",children:Object(x.jsxs)(s.d,{children:[Object(x.jsx)(s.b,{path:K,render:function(){return e?Object(x.jsx)(ce,{}):Object(x.jsx)(s.a,{to:le})}}),Object(x.jsx)(s.b,{path:le,render:function(){return e?Object(x.jsx)(s.a,{to:K}):Object(x.jsx)(oe,{})}}),Object(x.jsx)(s.b,{path:"/",exact:!1,render:function(){return e?Object(x.jsx)(s.a,{to:K}):Object(x.jsx)(s.a,{to:le})}})]})})]})},de=Object(E.b)({name:"counter",initialState:{value:0},reducers:{increment:function(e){e.value+=1},decrement:function(e){e.value-=1},incrementByAmount:function(e,t){e.value+=t.payload}}}),be=de.actions,me=(be.increment,be.decrement,be.incrementByAmount,de.reducer),je=Object(E.a)({reducer:{counter:me,mail:_,login:H}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var he=n(58),pe=n(33),fe=new he.a;c.a.render(Object(x.jsx)(r.a.StrictMode,{children:Object(x.jsx)(pe.a,{client:fe,children:Object(x.jsx)(d.a,{store:je,children:Object(x.jsx)(J.a,{children:Object(x.jsx)(ue,{})})})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[56,1,2]]]);
//# sourceMappingURL=main.4a01ee24.chunk.js.map