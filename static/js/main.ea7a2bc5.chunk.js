(this["webpackJsonpjmap-webmail"]=this["webpackJsonpjmap-webmail"]||[]).push([[0],{33:function(e,t,n){},38:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(19),i=n.n(s),c=(n(32),n(33),n(3)),o=(n(34),n(38),n(1));var l=function(){return Object(o.jsx)("div",{className:"mail-layout-center",children:Object(o.jsx)("div",{className:"has-text-weight-bold",children:"Nothing selected"})})},u=n(8),d=n(10),b=n(12),m=(n(21),function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,a="",r=0;r<e;r++)a+=t.charAt(Math.floor(Math.random()*n));return a}),j=function(e,t,n,a){return{name:e||"(unknown)",role:t||"",id:n||m(36),unreadEmails:a||0}},h={mailboxes:[j("INBOX","inbox","00000000-0000-0000-0000-000000000001",1)],list:[]},p=Object(b.b)({name:"mail",initialState:h,reducers:{setMailboxes:function(e,t){e.mailboxes=t.payload},setList:function(e,t){e.list=t.payload}}}),f=p.actions,x=f.setMailboxes,O=f.setList,v=function(e){return e.mail.mailboxes},g=function(e){return e.mail.list},y=p.reducer,N="/mail/",w=function(){var e=Object(c.g)("".concat(N,":mailboxId")),t=Object(c.g)("".concat(N,":mailboxId/:mailId")),n=(null===e||void 0===e?void 0:e.params.mailboxId)||"";return{mailboxId:n,mailId:n&&(null===t||void 0===t?void 0:t.params.mailId)||""}},k=function(e){switch(e.role){case"inbox":return"Inbox";case"drafts":return"Drafts";case"sent":return"Sent Messages";case"junk":return"Junk";case"trash":return"Deleted Messages";case"archive":return"Archive"}return e.name},I=function(e){switch(e.role){case"inbox":return"fas fa-inbox";case"drafts":return"fas fa-pencil-alt";case"sent":return"fas fa-paper-plane";case"junk":return"far fa-times-circle";case"trash":return"fas fa-trash-alt";case"archive":return"fas fa-archive"}return"Notes"===e.name?"far fa-sticky-note":"far fa-folder"},A=function(e){return!e.from||e.from.length<1?"(unknown)":e.from.map((function(e){return(null===(t=e)||void 0===t?void 0:t.name)?t.name:(null===t||void 0===t?void 0:t.email)?t.email:"(unknown)";var t})).join(", ")};var C=function(){return Object(o.jsx)("div",{className:"mail-layout-center",children:Object(o.jsxs)("div",{className:"has-text-weight-bold",children:["Mailbox is empty",Object(o.jsx)("nav",{className:"navbar has-no-background"})]})})};var S=function(){var e=w(),t=e.mailboxId,n=Object(u.d)(v),a=Object(u.d)(g);if(!t){var r=n.filter((function(e){return"inbox"===e.role}));r.length>0&&(t=r[0].id)}var s=n.filter((function(e){return e.id===t})),i=s.length>0?s[0]:j(),c=a.filter((function(e){return!(!e.mailboxIds||!Object.prototype.hasOwnProperty.call(e.mailboxIds,i.id))&&e.mailboxIds[i.id]})),l=e.mailId||"",b=c.length>0?"has-background-white":"";return Object(o.jsxs)("div",{className:"is-flex is-flex-grow-1 is-flex-direction-column is-clipped",children:[Object(o.jsxs)("div",{className:"mail-layout-title",children:[Object(o.jsx)(d.b,{to:N,className:"button is-small is-white mr-3 only-mobile",children:Object(o.jsx)("span",{className:"icon is-small",children:Object(o.jsx)("i",{className:"fas fa-chevron-left"})})}),k(i)]}),Object(o.jsx)("div",{className:"is-flex is-flex-grow-1 is-flex-direction-column overflowable ".concat(b),children:0===c.length?Object(o.jsx)(C,{}):c.map((function(e){var n=function(e){var t;return!1===(null===e||void 0===e||null===(t=e.keywords)||void 0===t?void 0:t.$seen)}(e)||e.id===l?"app-item-selected":"app-item";return Object(o.jsx)(d.b,{to:"".concat(N).concat(t,"/").concat(e.id),children:Object(o.jsxs)("div",{className:n,children:[Object(o.jsx)("p",{children:A(e)}),Object(o.jsx)("p",{children:e.subject}),Object(o.jsx)("p",{children:e.preview})]})},e.id)}))})]})};var E=function(){return Object(o.jsx)("div",{className:"mail-layout-center",children:Object(o.jsx)("div",{className:"has-text-weight-bold",children:"You do not have any mailboxes"})})};var M=function(){var e=Object(u.d)(v),t=w().mailboxId||"inbox";return"inbox"===t&&(t=e.length>0?e[0].id:""),0===e.length?Object(o.jsx)(E,{}):Object(o.jsx)("div",{className:"is-flex-grow-1 overflowable",children:e.map((function(e){var n=e.id===t?"app-item-selected":"app-item";return Object(o.jsx)(d.b,{to:"/mail/".concat(e.id),children:Object(o.jsxs)("div",{className:"icon-text ".concat(n),children:[Object(o.jsx)("span",{className:"icon mr-3",children:Object(o.jsx)("i",{className:I(e)})}),Object(o.jsx)("span",{children:k(e)}),e.unreadEmails>0&&Object(o.jsx)("span",{className:"tag is-normal is-rounded is-primary has-text-weight-bold ml-3",children:e.unreadEmails})]})},e.id)}))})};var P,z=function(){var e=w(),t="",n="hide-mobile",a="hide-mobile";return e.mailboxId&&(e.mailId?(t="hide-mobile",n="hide-mobile",a=""):(t="hide-mobile",n="",a="hide-mobile")),Object(o.jsxs)("div",{className:"mail-layout",children:[Object(o.jsx)("div",{className:"mail-layout-mailboxes ".concat(t),children:Object(o.jsx)(M,{})}),Object(o.jsx)("div",{className:"mail-layout-focused mail-layout-list ".concat(n),children:Object(o.jsx)(S,{})}),Object(o.jsx)("div",{className:"mail-layout-content ".concat(a),children:Object(o.jsx)(l,{})})]})},B=n(5),H=n.n(B),J=n(13),T=n(11),F=function(e){return Object(o.jsx)(o.Fragment,{children:e.cond&&e.children})},D=n(14),R=n(27),W=function(){var e=Object(J.a)(H.a.mark((function e(t){var n,a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="https://".concat(t,"/.well-known/jmap"),e.next=3,fetch(n);case 3:return a=e.sent,e.abrupt("return",a.url);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=function(){var e=Object(J.a)(H.a.mark((function e(t,n,a){var r,s,i,c,o;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:new Headers(Object(D.a)(Object(D.a)({},a),{},{"Content-Type":"application/json"})),method:"POST",body:JSON.stringify({using:["urn:ietf:params:jmap:core","urn:ietf:params:jmap:mail"],methodCalls:[["Mailbox/get",{accountId:n,ids:null},"0"]]})});case 2:return r=e.sent,e.next=5,r.json();case 5:if((s=e.sent).methodResponses){e.next=8;break}return e.abrupt("return",{success:!1,message:"not a valid JMAP response"});case 8:if((i=s.methodResponses)&&Array.isArray(i)&&1===i.length){e.next=11;break}return e.abrupt("return",{success:!1,message:"no valid response"});case 11:if("Mailbox/get"===(c=i[0])[0]){e.next=14;break}return e.abrupt("return",{success:!1,message:"not the expected method"});case 14:if(c[1]&&c[1].list&&Array.isArray(c[1].list)){e.next=16;break}return e.abrupt("return",{success:!1,message:"could not fetch mailboxes"});case 16:return o=c[1].list,e.abrupt("return",{success:!0,data:o});case 18:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),L=function(){var e=Object(J.a)(H.a.mark((function e(t,n,a){var r,s,i,c,o;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:new Headers(Object(D.a)(Object(D.a)({},a),{},{"Content-Type":"application/json"})),method:"POST",body:JSON.stringify({using:["urn:ietf:params:jmap:core","urn:ietf:params:jmap:mail"],methodCalls:[["Email/query",{accountId:n,position:0,limit:100,calculateTotal:!0},"0"],["Email/get",{accountId:n,"#ids":{resultOf:"0",name:"Email/query",path:"/ids"},properties:["threadId","mailboxIds","keywords","hasAttachment","from","subject","receivedAt","size","preview"]},"1"]]})});case 2:return r=e.sent,e.next=5,r.json();case 5:if((s=e.sent).methodResponses){e.next=8;break}return e.abrupt("return",{success:!1,message:"not a valid JMAP response"});case 8:if((i=s.methodResponses)&&Array.isArray(i)&&2===i.length){e.next=11;break}return e.abrupt("return",{success:!1,message:"no valid response"});case 11:if("Email/get"===(c=i[1])[0]){e.next=14;break}return e.abrupt("return",{success:!1,message:"not the expected method"});case 14:if(c[1]&&c[1].list&&Array.isArray(c[1].list)){e.next=16;break}return e.abrupt("return",{success:!1,message:"could not fetch emails"});case 16:return o=c[1].list,e.abrupt("return",{success:!0,data:o});case 18:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),Y=function(){var e=Object(J.a)(H.a.mark((function e(t,n){var a,r;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:new Headers(Object(D.a)(Object(D.a)({},n),{},{"Content-Type":"application/json"})),method:"GET"});case 2:return a=e.sent,e.next=5,a.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),G=function(e,t){return R.a.encode("".concat(e,":").concat(t))},U=(n(45),Object(b.b)({name:"login",initialState:{authenticated:!1,authorizationHeader:"",identifier:""},reducers:{login:function(e,t){e.authenticated=!0,e.authorizationHeader=t.payload.authorizationHeader,e.identifier=t.payload.identifier},logout:function(e){e.authenticated=!1,e.authorizationHeader="",e.identifier=""}}})),X=U.actions,$=X.login,K=(X.logout,function(e){return e.login.authenticated}),Q=U.reducer;!function(e){e[e.Identifier=0]="Identifier",e[e.Endpoint=1]="Endpoint",e[e.Credentials=2]="Credentials"}(P||(P={}));var V=function(){var e=Object(u.c)(),t=Object(a.useState)(P.Identifier),n=Object(T.a)(t,2),r=n[0],s=n[1],i=Object(a.useState)(""),c=Object(T.a)(i,2),l=c[0],d=c[1],b=Object(a.useState)(!1),m=Object(T.a)(b,2),j=m[0],h=m[1],p=Object(a.useState)(!1),f=Object(T.a)(p,2),v=f[0],g=f[1],y=Object(a.useState)(""),N=Object(T.a)(y,2),w=N[0],k=N[1],I=Object(a.useState)(""),A=Object(T.a)(I,2),C=A[0],S=A[1],E=Object(a.useState)(""),M=Object(T.a)(E,2),z=M[0],B=M[1],D=Object(a.useState)(!1),R=Object(T.a)(D,2),U=R[0],X=R[1],K=function(){var e=Object(J.a)(H.a.mark((function e(){var t,n;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!v){e.next=2;break}return e.abrupt("return");case 2:if(g(!0),w.includes("@")){e.next=8;break}return d("Your identifier is not an email. Please specify an endpoint manually."),s(P.Endpoint),g(!1),e.abrupt("return");case 8:if(t=w.trim().split("@").pop()){e.next=14;break}return d("Unable to discover a domain name in your email identifier. Please specify an endpoint manually."),s(P.Endpoint),g(!1),e.abrupt("return");case 14:return e.next=16,W(t);case 16:n=e.sent,B(n),s(P.Credentials),g(!1);case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=function(){var t=Object(J.a)(H.a.mark((function t(){var n,a,i;return H.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!v){t.next=2;break}return t.abrupt("return");case 2:if(g(!0),r!==P.Identifier){t.next=8;break}return g(!1),t.next=7,K();case 7:g(!0);case 8:if(r!==P.Endpoint){t.next=15;break}if(""!==z){t.next=13;break}return d("Endpoint is empty."),g(!1),t.abrupt("return");case 13:X(!0),s(P.Credentials);case 15:if(r!==P.Credentials){t.next=43;break}return n="Basic ".concat(G(w,C)),t.prev=17,t.next=20,Y(z,{Authorization:n});case 20:t.next=27;break;case 22:return t.prev=22,t.t0=t.catch(17),d("Bad credentials. Please retry."),g(!1),t.abrupt("return");case 27:return t.next=29,q(z,w,{Authorization:n});case 29:if((a=t.sent).success){t.next=34;break}return d(a.message),g(!1),t.abrupt("return");case 34:return t.next=36,L(z,w,{Authorization:n});case 36:if((i=t.sent).success){t.next=41;break}return d(i.message),g(!1),t.abrupt("return");case 41:return Object(u.b)((function(){e($({identifier:w,authorizationHeader:n})),e(x(a.data)),e(O(i.data))})),t.abrupt("return");case 43:g(!1);case 44:case"end":return t.stop()}}),t,null,[[17,22]])})));return function(){return t.apply(this,arguments)}}();return Object(o.jsx)("div",{className:"login-layout",children:Object(o.jsxs)("div",{children:[l&&Object(o.jsx)("article",{className:"message is-danger",children:Object(o.jsx)("div",{className:"message-body",children:l})}),Object(o.jsxs)("div",{className:"field",children:[Object(o.jsx)("label",{className:"label",htmlFor:"login-form-identifier",children:"Identifier"}),Object(o.jsx)("div",{className:"control",children:Object(o.jsx)("input",{autoFocus:!0,id:"login-form-identifier",className:"input",type:"email",placeholder:"john.doe@example.com",value:w,onChange:function(e){return k(e.target.value)}})})]}),Object(o.jsx)(F,{cond:j||r===P.Endpoint||U,children:Object(o.jsxs)("div",{className:"field",children:[Object(o.jsx)("label",{className:"label",htmlFor:"login-form-endpoint",children:"Endpoint"}),Object(o.jsx)("div",{className:"control",children:Object(o.jsx)("input",{id:"login-form-endpoint",className:"input",type:"url",placeholder:"https://example.com",value:z,onChange:function(e){return B(e.target.value)}})}),Object(o.jsx)("p",{className:"help",children:Object(o.jsx)("span",{className:"has-text-primary has-pointer",onClick:K,children:"Discover endpoint"})})]})}),Object(o.jsx)(F,{cond:j,children:Object(o.jsxs)("div",{className:"field",children:[Object(o.jsx)("label",{className:"label",htmlFor:"login-form-method",children:"Authentication method"}),Object(o.jsx)("div",{className:"control",children:Object(o.jsx)("div",{className:"select is-fullwidth",children:Object(o.jsx)("select",{id:"login-form-method",disabled:!0,children:Object(o.jsx)("option",{value:"Basic",children:"Password"})})})}),Object(o.jsx)("p",{className:"help",children:Object(o.jsx)("span",{className:"has-text-primary has-pointer",children:"Discover the available authentication methods"})})]})}),Object(o.jsx)(F,{cond:j||r>=P.Credentials,children:Object(o.jsxs)("div",{className:"field",children:[Object(o.jsx)("label",{className:"label",htmlFor:"login-form-password",children:"Password"}),Object(o.jsx)("div",{className:"control",children:Object(o.jsx)("input",{id:"login-form-password",className:"input",type:"password",placeholder:"********",value:C,onChange:function(e){return S(e.target.value)}})})]})}),Object(o.jsxs)("div",{className:"login-layout-bottom",children:[Object(o.jsx)("button",{className:"button is-primary",onClick:function(){return Q()},disabled:""===w&&!j,children:j||r===P.Credentials?"Sign In":"Next \xbb"}),Object(o.jsxs)("label",{className:"checkbox",children:[Object(o.jsx)("input",{type:"checkbox",checked:j,onChange:function(e){return h(e.target.checked)}}),Object(o.jsx)("span",{children:"More options"})]})]})]})})},Z="/login/";n(46);var _=function(){var e=Object(u.d)(K);return Object(o.jsxs)("div",{className:"app",children:[Object(o.jsx)("nav",{className:"navbar is-primary",children:Object(o.jsx)("div",{className:"navbar-brand",children:Object(o.jsx)("div",{className:"navbar-item",children:"JMAP Webmail"})})}),Object(o.jsx)("div",{className:"app-container",children:Object(o.jsxs)(c.d,{children:[Object(o.jsx)(c.b,{path:N,render:function(){return e?Object(o.jsx)(z,{}):Object(o.jsx)(c.a,{to:Z})}}),Object(o.jsx)(c.b,{path:Z,render:function(){return e?Object(o.jsx)(c.a,{to:N}):Object(o.jsx)(V,{})}}),Object(o.jsx)(c.b,{path:"/",exact:!1,render:function(){return e?Object(o.jsx)(c.a,{to:N}):Object(o.jsx)(c.a,{to:Z})}})]})})]})},ee=Object(b.b)({name:"counter",initialState:{value:0},reducers:{increment:function(e){e.value+=1},decrement:function(e){e.value-=1},incrementByAmount:function(e,t){e.value+=t.payload}}}),te=ee.actions,ne=(te.increment,te.decrement,te.incrementByAmount,ee.reducer),ae=Object(b.a)({reducer:{counter:ne,mail:y,login:Q}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(o.jsx)(r.a.StrictMode,{children:Object(o.jsx)(u.a,{store:ae,children:Object(o.jsx)(d.a,{children:Object(o.jsx)(_,{})})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[47,1,2]]]);
//# sourceMappingURL=main.ea7a2bc5.chunk.js.map