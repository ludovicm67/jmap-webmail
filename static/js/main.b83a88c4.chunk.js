(this["webpackJsonpjmap-webmail"]=this["webpackJsonpjmap-webmail"]||[]).push([[0],{37:function(e,t,n){},42:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n(0),c=n.n(r),s=n(20),i=n.n(s),l=(n(36),n(37),n(3));n(38),n(42);var o=function(){return Object(a.jsx)("div",{className:"mail-layout-center",children:Object(a.jsx)("div",{className:"has-text-weight-bold",children:"Nothing selected"})})},d=n(12),u=n(10),b=n(15),m=n(22),j=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,a="",r=0;r<e;r++)a+=t.charAt(Math.floor(Math.random()*n));return a},h=function(e,t,n,a){return{name:e||"(unknown)",role:t||"",id:n||j(36),unreadEmails:a||0}},f=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return{from:{name:j(8),email:"".concat(j(4),"@").concat(j(4),".").concat(j(2))},hasAttachment:!1,id:j(36),mailboxIds:Object(m.a)({},e,!0),preview:n||"Lorem ipsum\u2026",subject:t||"(no subject)",keywords:{$seen:a}}},p={mailboxes:[h("INBOX","inbox","00000000-0000-0000-0000-000000000001",1),h("Drafts","drafts","00000000-0000-0000-0000-000000000002"),h("Sent Messages","sent","00000000-0000-0000-0000-000000000003"),h("Junk","junk","00000000-0000-0000-0000-000000000004"),h("Deleted Messages","trash","00000000-0000-0000-0000-000000000005"),h("Archive","archive"),h("Notes")],list:[f("00000000-0000-0000-0000-000000000001"),f("00000000-0000-0000-0000-000000000001","Hello world!","How are you?",!1),f("00000000-0000-0000-0000-000000000001"),f("00000000-0000-0000-0000-000000000001"),f("00000000-0000-0000-0000-000000000001"),f("00000000-0000-0000-0000-000000000002"),f("00000000-0000-0000-0000-000000000002"),f("00000000-0000-0000-0000-000000000003"),f("00000000-0000-0000-0000-000000000003"),f("00000000-0000-0000-0000-000000000003"),f("00000000-0000-0000-0000-000000000003"),f("00000000-0000-0000-0000-000000000003"),f("00000000-0000-0000-0000-000000000004"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005"),f("00000000-0000-0000-0000-000000000005")]},x=Object(b.b)({name:"mail",initialState:p,reducers:{}}),v=function(e){return e.mail.mailboxes},O=function(e){return e.mail.list},g=x.reducer,N="/mail/",y=function(){var e=Object(l.f)("".concat(N,":mailboxId")),t=Object(l.f)("".concat(N,":mailboxId/:mailId")),n=(null===e||void 0===e?void 0:e.params.mailboxId)||"";return{mailboxId:n,mailId:n&&(null===t||void 0===t?void 0:t.params.mailId)||""}},w=function(e){switch(e.role){case"inbox":return"Inbox";case"drafts":return"Drafts";case"sent":return"Sent Messages";case"junk":return"Junk";case"trash":return"Deleted Messages";case"archive":return"Archive"}return e.name},k=function(e){switch(e.role){case"inbox":return"fas fa-inbox";case"drafts":return"fas fa-pencil-alt";case"sent":return"fas fa-paper-plane";case"junk":return"far fa-times-circle";case"trash":return"fas fa-trash-alt";case"archive":return"fas fa-archive"}return"Notes"===e.name?"far fa-sticky-note":"far fa-folder"},I=function(e){if(null===e||void 0===e?void 0:e.from){var t,n;if(null===(t=e.from)||void 0===t?void 0:t.name)return e.from.name;if(null===(n=e.from)||void 0===n?void 0:n.email)return e.from.email}return"(unknown)"};var C=function(){return Object(a.jsx)("div",{className:"mail-layout-center",children:Object(a.jsxs)("div",{className:"has-text-weight-bold",children:["Mailbox is empty",Object(a.jsx)("nav",{className:"navbar has-no-background"})]})})};var S=function(){var e=y(),t=e.mailboxId,n=Object(d.b)(v),r=Object(d.b)(O);if(!t){var c=n.filter((function(e){return"inbox"===e.role}));c.length>0&&(t=c[0].id)}var s=n.filter((function(e){return e.id===t})),i=s.length>0?s[0]:h(),l=r.filter((function(e){return!(!e.mailboxIds||!Object.prototype.hasOwnProperty.call(e.mailboxIds,i.id))&&e.mailboxIds[i.id]})),o=e.mailId||"",b=l.length>0?"has-background-white":"";return Object(a.jsxs)("div",{className:"is-flex is-flex-grow-1 is-flex-direction-column is-clipped",children:[Object(a.jsxs)("div",{className:"mail-layout-title",children:[Object(a.jsx)(u.b,{to:N,className:"button is-small is-white mr-3 only-mobile",children:Object(a.jsx)("span",{className:"icon is-small",children:Object(a.jsx)("i",{className:"fas fa-chevron-left"})})}),w(i)]}),Object(a.jsx)("div",{className:"is-flex is-flex-grow-1 is-flex-direction-column overflowable ".concat(b),children:0===l.length?Object(a.jsx)(C,{}):l.map((function(e){var n=function(e){var t;return!1===(null===e||void 0===e||null===(t=e.keywords)||void 0===t?void 0:t.$seen)}(e)||e.id===o?"app-item-selected":"app-item";return Object(a.jsx)(u.b,{to:"".concat(N).concat(t,"/").concat(e.id),children:Object(a.jsxs)("div",{className:n,children:[Object(a.jsx)("p",{children:I(e)}),Object(a.jsx)("p",{children:e.subject}),Object(a.jsx)("p",{children:e.preview})]})},e.id)}))})]})};var A=function(){return Object(a.jsx)("div",{className:"mail-layout-center",children:Object(a.jsx)("div",{className:"has-text-weight-bold",children:"You do not have any mailboxes"})})};var E=function(){var e=Object(d.b)(v),t=y().mailboxId||"inbox";return"inbox"===t&&(t=e.length>0?e[0].id:""),0===e.length?Object(a.jsx)(A,{}):Object(a.jsx)("div",{className:"is-flex-grow-1 overflowable",children:e.map((function(e){var n=e.id===t?"app-item-selected":"app-item";return Object(a.jsx)(u.b,{to:"/mail/".concat(e.id),children:Object(a.jsxs)("div",{className:"icon-text ".concat(n),children:[Object(a.jsx)("span",{className:"icon mr-3",children:Object(a.jsx)("i",{className:k(e)})}),Object(a.jsx)("span",{children:w(e)}),e.unreadEmails>0&&Object(a.jsx)("span",{className:"tag is-normal is-rounded is-primary has-text-weight-bold ml-3",children:e.unreadEmails})]})},e.id)}))})};var M,B=function(){var e=y(),t="",n="hide-mobile",r="hide-mobile";return e.mailboxId&&(e.mailId?(t="hide-mobile",n="hide-mobile",r=""):(t="hide-mobile",n="",r="hide-mobile")),Object(a.jsxs)("div",{className:"mail-layout",children:[Object(a.jsx)("div",{className:"mail-layout-mailboxes ".concat(t),children:Object(a.jsx)(E,{})}),Object(a.jsx)("div",{className:"mail-layout-focused mail-layout-list ".concat(n),children:Object(a.jsx)(S,{})}),Object(a.jsx)("div",{className:"mail-layout-content ".concat(r),children:Object(a.jsx)(o,{})})]})},P=n(7),J=n.n(P),D=n(13),F=n(11),H=function(e){return Object(a.jsx)(a.Fragment,{children:e.cond&&e.children})},T=n(19),W=n(30),z=function(){var e=Object(D.a)(J.a.mark((function e(t){var n,a;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="https://".concat(t,"/.well-known/jmap"),e.next=3,fetch(n);case 3:return a=e.sent,e.abrupt("return",a.url);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=Object(D.a)(J.a.mark((function e(t,n,a){var r,c,s,i,l;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:new Headers(Object(T.a)(Object(T.a)({},a),{},{"Content-Type":"application/json"})),method:"POST",body:JSON.stringify({using:["urn:ietf:params:jmap:core","urn:ietf:params:jmap:mail"],methodCalls:[["Mailbox/get",{accountId:n,ids:null},"0"]]})});case 2:return r=e.sent,e.next=5,r.json();case 5:if((c=e.sent).methodResponses){e.next=8;break}return e.abrupt("return",{success:!1,message:"not a valid JMAP response"});case 8:if((s=c.methodResponses)&&Array.isArray(s)&&1===s.length){e.next=11;break}return e.abrupt("return",{success:!1,message:"no valid response"});case 11:if("Mailbox/get"===(i=s[0])[0]){e.next=14;break}return e.abrupt("return",{success:!1,message:"not the expected method"});case 14:if(i[1]&&i[1].list&&Array.isArray(i[1].list)){e.next=16;break}return e.abrupt("return",{success:!1,message:"could not fetch mailboxes"});case 16:return l=i[1].list,e.abrupt("return",l);case 18:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),Y=function(){var e=Object(D.a)(J.a.mark((function e(t,n){var a,r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:new Headers(Object(T.a)(Object(T.a)({},n),{},{"Content-Type":"application/json"})),method:"GET"});case 2:return a=e.sent,e.next=5,a.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),$=function(e,t){return W.a.encode("".concat(e,":").concat(t))};n(49);!function(e){e[e.Identifier=0]="Identifier",e[e.Endpoint=1]="Endpoint",e[e.Credentials=2]="Credentials"}(M||(M={}));var G=function(){var e=Object(r.useState)(M.Identifier),t=Object(F.a)(e,2),n=t[0],c=t[1],s=Object(r.useState)(""),i=Object(F.a)(s,2),l=i[0],o=i[1],d=Object(r.useState)(!1),u=Object(F.a)(d,2),b=u[0],m=u[1],j=Object(r.useState)(!1),h=Object(F.a)(j,2),f=h[0],p=h[1],x=Object(r.useState)(""),v=Object(F.a)(x,2),O=v[0],g=v[1],N=Object(r.useState)(""),y=Object(F.a)(N,2),w=y[0],k=y[1],I=Object(r.useState)(""),C=Object(F.a)(I,2),S=C[0],A=C[1],E=Object(r.useState)(!1),B=Object(F.a)(E,2),P=B[0],T=B[1],W=function(){var e=Object(D.a)(J.a.mark((function e(){var t,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f){e.next=2;break}return e.abrupt("return");case 2:if(p(!0),O.includes("@")){e.next=8;break}return o("Your identifier is not an email. Please specify an endpoint manually."),c(M.Endpoint),p(!1),e.abrupt("return");case 8:if(t=O.trim().split("@").pop()){e.next=14;break}return o("Unable to discover a domain name in your email identifier. Please specify an endpoint manually."),c(M.Endpoint),p(!1),e.abrupt("return");case 14:return e.next=16,z(t);case 16:n=e.sent,A(n),c(M.Credentials),p(!1);case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),G=function(){var e=Object(D.a)(J.a.mark((function e(){var t;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f){e.next=2;break}return e.abrupt("return");case 2:if(p(!0),n!==M.Identifier){e.next=8;break}return p(!1),e.next=7,W();case 7:p(!0);case 8:if(n!==M.Endpoint){e.next=15;break}if(""!==S){e.next=13;break}return o("Endpoint is empty."),p(!1),e.abrupt("return");case 13:T(!0),c(M.Credentials);case 15:if(n!==M.Credentials){e.next=29;break}return e.prev=16,e.next=19,Y(S,{Authorization:"Basic ".concat($(O,w))});case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(16),o("Bad credentials. Please retry."),p(!1);case 25:return e.next=27,R(S,O,{Authorization:"Basic ".concat($(O,w))});case 27:t=e.sent,console.log(t);case 29:p(!1);case 30:case"end":return e.stop()}}),e,null,[[16,21]])})));return function(){return e.apply(this,arguments)}}();return Object(a.jsx)("div",{className:"login-layout",children:Object(a.jsxs)("div",{children:[l&&Object(a.jsx)("article",{className:"message is-danger",children:Object(a.jsx)("div",{className:"message-body",children:l})}),Object(a.jsxs)("div",{className:"field",children:[Object(a.jsx)("label",{className:"label",htmlFor:"login-form-identifier",children:"Identifier"}),Object(a.jsx)("div",{className:"control",children:Object(a.jsx)("input",{autoFocus:!0,id:"login-form-identifier",className:"input",type:"email",placeholder:"john.doe@example.com",value:O,onChange:function(e){return g(e.target.value)}})})]}),Object(a.jsx)(H,{cond:b||n===M.Endpoint||P,children:Object(a.jsxs)("div",{className:"field",children:[Object(a.jsx)("label",{className:"label",htmlFor:"login-form-endpoint",children:"Endpoint"}),Object(a.jsx)("div",{className:"control",children:Object(a.jsx)("input",{id:"login-form-endpoint",className:"input",type:"url",placeholder:"https://example.com",value:S,onChange:function(e){return A(e.target.value)}})}),Object(a.jsx)("p",{className:"help",children:Object(a.jsx)("span",{className:"has-text-primary has-pointer",onClick:W,children:"Discover endpoint"})})]})}),Object(a.jsx)(H,{cond:b,children:Object(a.jsxs)("div",{className:"field",children:[Object(a.jsx)("label",{className:"label",htmlFor:"login-form-method",children:"Authentication method"}),Object(a.jsx)("div",{className:"control",children:Object(a.jsx)("div",{className:"select is-fullwidth",children:Object(a.jsx)("select",{id:"login-form-method",disabled:!0,children:Object(a.jsx)("option",{value:"Basic",children:"Password"})})})}),Object(a.jsx)("p",{className:"help",children:Object(a.jsx)("span",{className:"has-text-primary has-pointer",children:"Discover the available authentication methods"})})]})}),Object(a.jsx)(H,{cond:b||n>=M.Credentials,children:Object(a.jsxs)("div",{className:"field",children:[Object(a.jsx)("label",{className:"label",htmlFor:"login-form-password",children:"Password"}),Object(a.jsx)("div",{className:"control",children:Object(a.jsx)("input",{id:"login-form-password",className:"input",type:"password",placeholder:"********",value:w,onChange:function(e){return k(e.target.value)}})})]})}),Object(a.jsxs)("div",{className:"login-layout-bottom",children:[Object(a.jsx)("button",{className:"button is-primary",onClick:function(){return G()},disabled:""===O&&!b,children:b||n===M.Credentials?"Sign In":"Next \xbb"}),Object(a.jsxs)("label",{className:"checkbox",children:[Object(a.jsx)("input",{type:"checkbox",checked:b,onChange:function(e){return m(e.target.checked)}}),Object(a.jsx)("span",{children:"More options"})]})]})]})})};n(50);var L=function(){return Object(a.jsxs)("div",{className:"app",children:[Object(a.jsx)("nav",{className:"navbar is-primary",children:Object(a.jsx)("div",{className:"navbar-brand",children:Object(a.jsx)("div",{className:"navbar-item",children:"JMAP Webmail"})})}),Object(a.jsx)("div",{className:"app-container",children:Object(a.jsxs)(l.c,{children:[Object(a.jsx)(l.a,{path:"/login/",component:G}),Object(a.jsx)(l.a,{path:N,component:B})]})})]})},U=Object(b.b)({name:"counter",initialState:{value:0},reducers:{increment:function(e){e.value+=1},decrement:function(e){e.value-=1},incrementByAmount:function(e,t){e.value+=t.payload}}}),X=U.actions,q=(X.increment,X.decrement,X.incrementByAmount,U.reducer),K=Object(b.a)({reducer:{counter:q,mail:g}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(a.jsx)(c.a.StrictMode,{children:Object(a.jsx)(d.a,{store:K,children:Object(a.jsx)(u.a,{children:Object(a.jsx)(L,{})})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[51,1,2]]]);
//# sourceMappingURL=main.b83a88c4.chunk.js.map